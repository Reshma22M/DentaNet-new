<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>DentaNet - Create Your Account</title>
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet"/>
    <link href="public/css/styles.css" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#7f13ec",
              accent: "#00f2fe",
              "background-light": "#faf5ff",
              "background-dark": "#0f172a",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
              sans: ["Inter", "sans-serif"],
            },
          },
        },
      };
    </script>
</head>
<body class="font-sans text-slate-900 dark:text-slate-100 min-h-screen flex flex-col bg-background-light dark:bg-background-dark">
    <header class="fixed top-0 left-0 right-0 z-50 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center gap-2">
                    <img src="blue-logo.svg" alt="DentaNet Logo" class="h-24 w-auto" />
                </div>
                <nav class="hidden md:flex items-center gap-8">
                    <a class="text-sm font-medium hover:text-primary transition-colors" href="index.html">Home</a>
                    <a class="text-sm font-medium hover:text-primary transition-colors" href="index.html#about">About</a>
                    <a class="bg-primary/10 text-primary hover:bg-primary hover:text-white px-5 py-2 rounded-full text-sm font-semibold transition-all duration-200" href="login.html">Log In</a>
                </nav>
            </div>
        </div>
    </header>
    
    <main class="flex-grow pt-16 flex items-center justify-center relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-sky-100 to-blue-50 dark:from-slate-900 dark:to-slate-800"></div>
        <div class="relative z-10 w-full max-w-xl px-4 py-12">
            <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl shadow-2xl rounded-3xl p-8 md:p-10 border border-slate-200 dark:border-slate-700">
                <div class="text-center mb-8">
                    <img src="blue-logo.svg" alt="DentaNet Logo" class="h-32 w-auto mx-auto mb-4" />
                    <h1 class="text-3xl font-extrabold text-slate-800 dark:text-white">Create Your Account</h1>
                    <p class="text-slate-500 dark:text-slate-400 mt-2">Join DentaNet LMS</p>
                </div>
                
                <!-- Step 1: User Information -->
                <div id="step1" class="space-y-5">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Full Name</label>
                        <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="fullname" type="text" placeholder="Reshma mohamed" required/>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Letters and spaces only (3-200 characters)</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Email</label>
                        <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="email" type="email" placeholder="your.email@gmail.com" required/>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Use any valid email address</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Password</label>
                            <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required/>
                            <div id="passwordRequirements" class="mt-2 space-y-1 text-xs">
                                <div id="req-length" class="flex items-center gap-1 text-slate-500">
                                    <span class="req-icon">‚óã</span>
                                    <span>At least 8 characters</span>
                                </div>
                                <div id="req-uppercase" class="flex items-center gap-1 text-slate-500">
                                    <span class="req-icon">‚óã</span>
                                    <span>One uppercase letter</span>
                                </div>
                                <div id="req-lowercase" class="flex items-center gap-1 text-slate-500">
                                    <span class="req-icon">‚óã</span>
                                    <span>One lowercase letter</span>
                                </div>
                                <div id="req-number" class="flex items-center gap-1 text-slate-500">
                                    <span class="req-icon">‚óã</span>
                                    <span>One number</span>
                                </div>
                                <div id="req-special" class="flex items-center gap-1 text-slate-500">
                                    <span class="req-icon">‚óã</span>
                                    <span>One special character (@$!%*?&)</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Confirm Password</label>
                            <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="confirmPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required/>
                            <div id="passwordMatch" class="mt-2 text-xs hidden">
                                <div class="flex items-center gap-1">
                                    <span id="match-icon">‚óã</span>
                                    <span id="match-text">Passwords must match</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3">Select Your Role</label>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="role-btn border-2 border-slate-300 dark:border-slate-600 rounded-xl p-4 text-center hover:border-primary transition-all" type="button" data-role="lecturer">
                                <span class="material-symbols-outlined text-2xl text-slate-600 dark:text-slate-400">school</span>
                                <p class="text-xs font-semibold mt-2 text-slate-700 dark:text-slate-300">Lecturer</p>
                            </button>
                            <button class="role-btn border-2 border-primary bg-primary/10 rounded-xl p-4 text-center active" type="button" data-role="student">
                                <span class="material-symbols-outlined text-2xl text-primary">person</span>
                                <p class="text-xs font-semibold mt-2 text-primary">Student</p>
                            </button>
                        </div>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Admin accounts are managed separately</p>
                    </div>
                    
                    <!-- Student-specific fields -->
                    <div id="studentFields" class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Batch Year</label>
                                <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="batchYear" type="number" placeholder="2023" min="2000" max="2030"/>
                                <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Year between 2000-2030</p>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Registration Number</label>
                                <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="regNumber" type="text" placeholder="DENT/2023/001"/>
                                <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">Format: DENT/YYYY/XXX (001-200)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Lecturer-specific fields -->
                    <div id="lecturerFields" class="space-y-4 hidden">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Department</label>
                                <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="department" type="text" placeholder="Prosthetic Dentistry"/>
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5">Specialization</label>
                                <input class="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all" id="specialization" type="text" placeholder="Crown & Bridge"/>
                            </div>
                        </div>
                    </div>
                    
                    <button id="sendOtpBtn" class="w-full bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl" type="button">
                        Send OTP to Email
                    </button>
                </div>
                
                <!-- Step 2: OTP Verification -->
                <div id="step2" class="space-y-5 hidden">
                    <div class="bg-green-50 dark:bg-green-900/20 border-2 border-green-300 dark:border-green-700 rounded-xl p-5 mb-4">
                        <p class="text-base text-green-800 dark:text-green-200 font-bold mb-2">üìß OTP Sent Successfully!</p>
                        <p class="text-sm text-green-700 dark:text-green-300 mb-2">‚úÖ Check your email inbox and spam folder</p>
                        <p class="text-xs text-green-600 dark:text-green-400 mt-3">‚è±Ô∏è Code expires in 5 minutes</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-1.5 text-center">Enter OTP Code</label>
                        <input class="w-full px-4 py-4 rounded-xl border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 focus:ring-2 focus:ring-primary focus:border-transparent dark:text-white transition-all text-center text-3xl font-bold tracking-[0.5em]" id="otp" type="text" maxlength="6" placeholder="000000" pattern="[0-9]{6}" required/>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 text-center">Code expires in 5 minutes</p>
                    </div>
                    
                    <button id="verifyBtn" class="w-full bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white font-bold py-4 rounded-xl transition-all shadow-lg hover:shadow-xl" type="button">
                        Verify OTP & Create Account
                    </button>
                    
                    <button id="backBtn" class="w-full text-slate-600 dark:text-slate-400 font-semibold py-2 hover:text-primary transition-all" type="button">
                        ‚Üê Back to Edit Information
                    </button>
                </div>
                
                <div class="text-center mt-6">
                    <p class="text-sm text-slate-500 dark:text-slate-400">
                        Already have an account? 
                        <a class="text-primary font-bold hover:underline" href="login.html">Login</a>
                    </p>
                </div>
            </div>
        </div>
    </main>
    
    <button class="fixed bottom-6 right-6 p-3 rounded-full bg-white dark:bg-slate-800 shadow-xl border border-slate-200 dark:border-slate-700 z-50" onclick="document.documentElement.classList.toggle('dark')">
        <span class="material-symbols-outlined dark:hidden">dark_mode</span>
        <span class="material-symbols-outlined hidden dark:block text-yellow-400">light_mode</span>
    </button>
    
    <script>
        let selectedRole = 'student';
        let formData = {};
        
        // Real-time password validation
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        
        passwordInput.addEventListener('input', function() {
            const password = this.value;
            
            // Check length
            updateRequirement('req-length', password.length >= 8);
            
            // Check uppercase
            updateRequirement('req-uppercase', /[A-Z]/.test(password));
            
            // Check lowercase
            updateRequirement('req-lowercase', /[a-z]/.test(password));
            
            // Check number
            updateRequirement('req-number', /\d/.test(password));
            
            // Check special character
            updateRequirement('req-special', /[@$!%*?&]/.test(password));
            
            // Check match if confirm password has value
            if (confirmPasswordInput.value) {
                checkPasswordMatch();
            }
        });
        
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);
        
        function updateRequirement(id, met) {
            const element = document.getElementById(id);
            const icon = element.querySelector('.req-icon');
            
            if (met) {
                element.classList.remove('text-slate-500');
                element.classList.add('text-green-600', 'dark:text-green-400');
                icon.textContent = '‚úì';
            } else {
                element.classList.remove('text-green-600', 'dark:text-green-400');
                element.classList.add('text-slate-500');
                icon.textContent = '‚óã';
            }
        }
        
        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const matchDiv = document.getElementById('passwordMatch');
            const matchIcon = document.getElementById('match-icon');
            const matchText = document.getElementById('match-text');
            
            if (confirmPassword.length > 0) {
                matchDiv.classList.remove('hidden');
                
                if (password === confirmPassword && password.length > 0) {
                    matchDiv.classList.remove('text-red-600', 'dark:text-red-400');
                    matchDiv.classList.add('text-green-600', 'dark:text-green-400');
                    matchIcon.textContent = '‚úì';
                    matchText.textContent = 'Passwords match';
                } else {
                    matchDiv.classList.remove('text-green-600', 'dark:text-green-400');
                    matchDiv.classList.add('text-red-600', 'dark:text-red-400');
                    matchIcon.textContent = '‚úó';
                    matchText.textContent = 'Passwords do not match';
                }
            } else {
                matchDiv.classList.add('hidden');
            }
        }
        
        // Role selection
        document.querySelectorAll('.role-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.role-btn').forEach(b => {
                    b.classList.remove('active', 'border-primary', 'bg-primary/10');
                    b.classList.add('border-slate-300', 'dark:border-slate-600');
                    b.querySelector('.material-symbols-outlined').classList.remove('text-primary');
                    b.querySelector('.material-symbols-outlined').classList.add('text-slate-600', 'dark:text-slate-400');
                    b.querySelector('p').classList.remove('text-primary');
                    b.querySelector('p').classList.add('text-slate-700', 'dark:text-slate-300');
                });
                
                this.classList.add('active', 'border-primary', 'bg-primary/10');
                this.classList.remove('border-slate-300', 'dark:border-slate-600');
                this.querySelector('.material-symbols-outlined').classList.add('text-primary');
                this.querySelector('.material-symbols-outlined').classList.remove('text-slate-600', 'dark:text-slate-400');
                this.querySelector('p').classList.add('text-primary');
                this.querySelector('p').classList.remove('text-slate-700', 'dark:text-slate-300');
                
                selectedRole = this.dataset.role;
                
                // Show/hide role-specific fields
                if (selectedRole === 'student') {
                    document.getElementById('studentFields').classList.remove('hidden');
                    document.getElementById('lecturerFields').classList.add('hidden');
                    document.getElementById('batchYear').required = true;
                    document.getElementById('regNumber').required = true;
                    document.getElementById('department').required = false;
                    document.getElementById('specialization').required = false;
                } else if (selectedRole === 'lecturer') {
                    document.getElementById('studentFields').classList.add('hidden');
                    document.getElementById('lecturerFields').classList.remove('hidden');
                    document.getElementById('batchYear').required = false;
                    document.getElementById('regNumber').required = false;
                    document.getElementById('department').required = false;
                    document.getElementById('specialization').required = false;
                }
            });
        });
        
        // Send OTP
        document.getElementById('sendOtpBtn').addEventListener('click', async function() {
            const fullname = document.getElementById('fullname').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!fullname || !email || !password || !confirmPassword) {
                alert('Please fill in all required fields');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            if (password.length < 8) {
                alert('Password must be at least 8 characters');
                return;
            }
            
            // Validate password requirements
            if (!/[A-Z]/.test(password)) {
                alert('Password must contain at least one uppercase letter');
                return;
            }
            if (!/[a-z]/.test(password)) {
                alert('Password must contain at least one lowercase letter');
                return;
            }
            if (!/\d/.test(password)) {
                alert('Password must contain at least one number');
                return;
            }
            if (!/[@$!%*?&]/.test(password)) {
                alert('Password must contain at least one special character (@$!%*?&)');
                return;
            }
            
            // Validate role-specific fields
            if (selectedRole === 'student') {
                const batchYear = document.getElementById('batchYear').value;
                const regNumber = document.getElementById('regNumber').value.trim();
                if (!batchYear || !regNumber) {
                    alert('Students must provide batch year and registration number');
                    return;
                }
                
                // Validate registration number format
                const regNumberPattern = /^DENT\/\d{4}\/\d{3}$/;
                if (!regNumberPattern.test(regNumber)) {
                    alert('Registration number must follow format: DENT/YYYY/XXX (e.g., DENT/2023/001)');
                    return;
                }
                
                // Extract and validate year and number
                const parts = regNumber.split('/');
                const year = parseInt(parts[1]);
                const num = parseInt(parts[2]);
                
                if (year < 2000 || year > 2030) {
                    alert('Registration number year must be between 2000-2030');
                    return;
                }
                
                if (num < 1 || num > 200) {
                    alert('Registration number must be between 001-200');
                    return;
                }
            }
            
            const nameParts = fullname.split(' ');
            formData = {
                email,
                password,
                fullName: fullname,
                firstName: nameParts[0],
                lastName: nameParts.slice(1).join(' ') || nameParts[0],
                role: selectedRole
            };
            
            // Add role-specific data
            if (selectedRole === 'student') {
                formData.batchYear = parseInt(document.getElementById('batchYear').value);
                formData.registrationNumber = document.getElementById('regNumber').value.trim();
            } else if (selectedRole === 'lecturer') {
                formData.department = document.getElementById('department').value.trim() || null;
                formData.specialization = document.getElementById('specialization').value.trim() || null;
            }
            
            this.disabled = true;
            this.innerHTML = '<span class="animate-pulse">Sending OTP...</span>';
            
            try {
                const response = await fetch('http://localhost:3000/api/registration/send-otp', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, role: selectedRole })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ OTP sent successfully!\n\nPlease check your email inbox and spam folder for the verification code.');
                    document.getElementById('step1').classList.add('hidden');
                    document.getElementById('step2').classList.remove('hidden');
                    document.getElementById('otp').focus();
                } else {
                    alert('‚ùå Error: ' + (data.error || 'Failed to send OTP. Please try again.'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Connection error. Make sure the backend server is running on port 3000.');
            } finally {
                this.disabled = false;
                this.innerHTML = 'Send OTP to Email';
            }
        });
        
        // Verify OTP and Register
        document.getElementById('verifyBtn').addEventListener('click', async function() {
            const otp = document.getElementById('otp').value.trim();
            
            if (!otp || otp.length !== 6) {
                alert('Please enter a valid 6-digit OTP');
                return;
            }
            
            this.disabled = true;
            this.innerHTML = '<span class="animate-pulse">Verifying...</span>';
            
            try {
                const response = await fetch('http://localhost:3000/api/registration/verify-and-register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ...formData, otp })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    alert('‚úÖ Registration successful! Please login with your credentials.');
                    window.location.href = 'login.html';
                } else {
                    console.error('Registration error:', data);
                    alert('‚ùå Registration Failed\n\n' + (data.error || 'Unknown error. Please try again.'));
                }
            } catch (error) {
                console.error('Network error:', error);
                alert('‚ùå Connection Error\n\nCannot reach the server. Please ensure the backend is running and try again.');
            } finally {
                this.disabled = false;
                this.innerHTML = 'Verify OTP & Create Account';
            }
        });
        
        // Back button
        document.getElementById('backBtn').addEventListener('click', function() {
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('otp').value = '';
        });
        
        // Auto-format OTP input (numbers only)
        document.getElementById('otp').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    </script>
</body>
</html>
